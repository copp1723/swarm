# Render Deployment Checklist

## ‚úÖ Pre-Deployment Setup

### 1. API Keys & Services
- [ ] **OpenRouter API Key**: Add `OPENROUTER_API_KEY` in Render environment variables
- [ ] **Mailgun Setup**: 
  - [ ] Create Mailgun account and domain
  - [ ] Get `MAILGUN_API_KEY`, `MAILGUN_DOMAIN`, `MAILGUN_SIGNING_KEY`
  - [ ] Configure DNS records for your domain
- [ ] **Sentry Account**: Get `SENTRY_DSN` for error tracking

### 2. Generate Security Keys
```bash
# Generate these locally and add to Render environment variables
python -c "import secrets; print('SECRET_KEY=' + secrets.token_hex(32))"
python -c "import secrets; print('JWT_SECRET_KEY=' + secrets.token_hex(32))"
```

## üóÑÔ∏è Database & Redis Setup

### 1. PostgreSQL Database
- [ ] Create PostgreSQL service in Render Dashboard
  - Name: `swarm-db`
  - Plan: Starter ($7/month) for 1GB storage
  - Copy `DATABASE_URL` when ready

### 2. Redis Instance
- [ ] Create Redis service in Render Dashboard
  - Name: `swarm-redis` 
  - Plan: Starter ($7/month) for reliable performance
  - Copy `REDIS_URL` when ready

## üöÄ Web Service Deployment

### 1. Create Web Service
- [ ] Connect your GitHub repository
- [ ] Service Name: `swarm-mcp-app`
- [ ] Environment: `Python 3`
- [ ] Region: Choose closest to your users
- [ ] Branch: `main` (or your production branch)
- [ ] Build Command: 
  ```bash
  pip install -r config/requirements/requirements.txt && pip install -r config/requirements/requirements_email_agent.txt
  ```
- [ ] Start Command:
  ```bash
  gunicorn -w $WEB_CONCURRENCY --worker-class gevent --bind 0.0.0.0:$PORT --timeout 120 app_production:app
  ```

### 2. Configure Service Settings
- [ ] **Plan**: Basic ($7/month) - 1GB RAM, 0.5 CPU
- [ ] **Health Check Path**: `/ready`
- [ ] **Port**: `10000`
- [ ] **Auto-Deploy**: ‚úÖ Enabled

## üîß Environment Variables Configuration

Copy these into your Render Web Service environment variables:

```bash
# Core Application
FLASK_ENV=production
NODE_ENV=production
PORT=10000
WEB_CONCURRENCY=2

# Database (Auto-populated by Render)
DATABASE_URL=<auto-generated-by-render>
POSTGRES_POOL_SIZE=10
POSTGRES_MAX_OVERFLOW=20

# Redis (Auto-populated by Render)  
REDIS_URL=<auto-generated-by-render>
REDIS_MAX_CONNECTIONS=50

# Celery (Background Tasks)
ENABLE_CELERY=true
CELERY_BROKER_URL=${REDIS_URL}/1
CELERY_RESULT_BACKEND=${REDIS_URL}/2

# Your API Keys
OPENROUTER_API_KEY=<your-openrouter-key>
SECRET_KEY=<generated-secret-from-above>
JWT_SECRET_KEY=<generated-jwt-secret-from-above>

# Email Configuration
MAILGUN_API_KEY=<your-mailgun-key>
MAILGUN_DOMAIN=mail.yourdomain.com
MAILGUN_SIGNING_KEY=<your-mailgun-signing-key>
DEFAULT_FROM_EMAIL=agent@yourdomain.com

# MCP Filesystem (Full Access + Logging)
DISABLE_MCP_FILESYSTEM=false
MCP_FILESYSTEM_ALLOWED_DIRS=/app
MCP_FILESYSTEM_LOG_OPERATIONS=true

# Features
ENABLE_WEBSOCKETS=true
ENABLE_CONVOY=true

# Monitoring
SENTRY_DSN=<your-sentry-dsn>
HEALTH_CHECK_PATH=/ready

# CORS (Update with your actual Render URL)
ALLOWED_ORIGINS=https://your-app-name.onrender.com
```

## üîÑ Background Workers (Optional but Recommended)

### 1. Create Background Worker Service
- [ ] Service Type: Background Worker
- [ ] Connect same repository  
- [ ] Name: `swarm-celery-worker`
- [ ] Start Command:
  ```bash
  celery -A app_production.celery worker --loglevel=info --concurrency=2
  ```
- [ ] Plan: Basic ($7/month)
- [ ] Use same environment variables as web service

## üìß Mailgun Email Setup

### 1. Domain Configuration
- [ ] Add your domain to Mailgun
- [ ] Configure DNS records (MX, TXT, CNAME)
- [ ] Verify domain in Mailgun dashboard

### 2. Email Route Setup
- [ ] Go to Mailgun ‚Üí Receiving ‚Üí Routes
- [ ] Create route:
  - Expression: `match_recipient("agent@yourdomain.com")`
  - Action: `forward("https://your-app-name.onrender.com/api/email-agent/webhooks/mailgun")`

## üîç Testing & Verification

### 1. Health Checks
```bash
# Test basic health
curl https://your-app-name.onrender.com/ready

# Test MCP filesystem
curl https://your-app-name.onrender.com/api/mcp/filesystem/status
```

### 2. Email Testing  
```bash
# Send test email to your configured agent email
# Should appear in logs and be processed by agents
```

### 3. Monitor Logs
- [ ] Check Render logs for any startup errors
- [ ] Verify database migrations completed
- [ ] Confirm MCP filesystem is accessible
- [ ] Test agent responses

## üí∞ Cost Breakdown (Your Configuration)

| Service | Plan | Monthly Cost |
|---------|------|--------------|
| Web Service | Basic (1GB RAM) | $7 |
| PostgreSQL | Starter (1GB) | $7 |  
| Redis | Starter | $7 |
| Celery Worker | Basic | $7 |
| **Total** | | **$28/month** |

## üö® Troubleshooting

### Common Issues:
1. **Build Failures**: Check requirements.txt paths are correct
2. **Database Connection**: Verify `DATABASE_URL` is auto-populated
3. **MCP Filesystem**: Check Node.js is available in build environment
4. **Email Processing**: Verify Mailgun webhook URLs match your deployment

### Support Resources:
- Render Logs: Check in dashboard for real-time logs
- Health Check: `https://your-app-name.onrender.com/ready`
- Filesystem Status: `https://your-app-name.onrender.com/api/mcp/filesystem/status`

## üéØ Next Steps After Deployment

1. **Set Up Custom Domain** (optional)
2. **Configure Email Workflows** 
3. **Test Agent Functionality**
4. **Set Up Monitoring Alerts**
5. **Create Backup Strategy**

---

**Note**: Replace `your-app-name` with your actual Render service name throughout this checklist.

